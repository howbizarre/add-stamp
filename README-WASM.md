# PSN Web Galleries

Уеб приложение за галерии с функционалност за добавяне на воден знак към снимки чрез WASM.

## Функционалности

- Качване на множество снимки
- Избор на PNG файл като воден знак (Stamp)
- Добавяне на воден знак върху снимките чрез WASM модул
- Експорт на резултатните снимки във формат WebP

## Настройка и стартиране

### Предварителни изисквания

1. Node.js (v18 или по-нова версия)
2. Rust (за билдване на WASM модула)
3. wasm-pack

### Инсталиране на wasm-pack

```bash
# Инсталиране на wasm-pack
cargo install wasm-pack
```

### Стартиране на проекта

1. Инсталиране на зависимости:
```bash
npm install
```

2. Билдване на WASM модула и стартиране на development сървъра:
```bash
npm run dev:wasm
```

Или отделно:

2a. Билдване на WASM модула:
```bash
npm run build:wasm
```

2b. Стартиране на development сървъра:
```bash
npm run dev
```

### Полезни команди

```bash
# Почистване на WASM билд файловете
npm run clean:wasm

# Само билдване на WASM без стартиране на сървъра
npm run build:wasm

# Стартиране на development сървъра с предварително билдване на WASM
npm run dev:wasm
```

### Билдване за продукция

```bash
npm run build
```

## Използване

1. **Качване на снимки**: Използвайте "Multiple Images Gallery" секцията за качване на снимките, върху които искате да добавите воден знак.

2. **Избор на воден знак**: Използвайте "Stamp Picker" секцията за избор на PNG файл, който ще служи като воден знак.

3. **Добавяне на воден знак**: След като са избрани и снимки, и воден знак, ще се появи бутон "Add Stamp". Натиснете го за да започне процеса.

4. **Избор на директория**: По време на обработката, браузърът ще поиска да изберете директория за записване (в модерни браузъри). Изберете директорията, където искате да се създаде папката "stamped-images".

5. **Преглед на резултата**: След приключване на обработката, заглавието ще се промени на "Stamped Gallery" и ще се покажат снимките с добавен воден знак.

6. **Записване**: Натиснете бутона "Save to Directory" за да запишете всички снимки наведнъж в под-директорията "stamped-images".

7. **Финализиране**: След успешно записване, бутонът "Save to Directory" ще изчезне и ще остане само етикетът "✓ Stamped Images".

### Workflow States

- **Начално състояние**: Заглавие "Gallery" + бутон за качване на снимки
- **Готов за обработка**: Бутон "Add Stamp" (когато има снимки и воден знак)
- **По време на обработка**: Progress bar с анимация
- **Готов за записване**: Заглавие "Stamped Gallery" + бутон "Save to Directory"
- **Записано**: Заглавие "Stamped Gallery" + етикет "✓ Stamped Images"

### Забележки за File System Access API

- **Модерни браузъри**: Функционалността за записване в директория работи в Chrome, Edge и други браузъри, базирани на Chromium
- **Еднократно разрешение**: Директорията се избира веднъж по време на обработката, записването става без допълнителни въпроси
- **Fallback**: Ако браузърът не поддържа File System Access API, снимките ще бъдат изтеглени индивидуално
- **Permissions**: Браузърът ще поиска разрешение за достъп до файловата система само веднъж

## Технически детайли

### WASM Модул

WASM модулът е написан на Rust и използва библиотеката `image` за обработка на снимките. Той:

- Зарежда воден знак от PNG файл
- Мащабира водния знак да покрива цялата снимка, запазвайки пропорциите
- Центрира водния знак
- Прилага го с 50% прозрачност
- Експортира резултата във формат WebP

### File System Integration

Приложението използва File System Access API за:

- **Автоматично създаване** на под-директория "stamped-images"
- **Директно записване** на файловете в избраната директория
- **Fallback към downloads** при липса на поддръжка от браузъра
- **Запазване на оригиналните имена** с "_stamped.webp" суфикс

### Архитектура

- **Frontend**: Nuxt 3 с Vue 3 и TypeScript
- **Styling**: Tailwind CSS
- **Image Processing**: Rust/WASM модул
- **File System**: File System Access API (с fallback)
- **Deployment**: Cloudflare Workers

## Структура на файловете

```
├── app/
│   ├── components/
│   │   ├── ImageGallery.vue      # Галерия за показване на снимки
│   │   ├── ImageUploader.vue     # Компонент за качване на снимки
│   │   └── StampPicker.vue       # Компонент за избор на воден знак
│   ├── composables/
│   │   └── useImageStamping.ts   # Композабъл за работа с WASM модула
│   └── app.vue                   # Главен компонент
├── wasm/
│   ├── src/
│   │   └── lib.rs               # Rust код за WASM модула
│   └── Cargo.toml               # Rust зависимости
├── public/
│   └── wasm/                    # Билдвани WASM файлове
└── build-wasm.bat              # Скрипт за билдване на Windows
```

## Грешки и отстраняване

Ако получавате грешка при зареждане на WASM модула, уверете се че:

1. Сте инсталирали `wasm-pack`
2. Сте изпълнили `npm run build:wasm`
3. Файловете в `public/wasm/` са налични

За повече информация проверете конзолата на браузъра за детайлни съобщения за грешки.
